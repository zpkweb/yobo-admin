{"version":3,"file":"pages/auth/_type.js","sources":["webpack:///./pages/auth/_type.vue?030f","webpack:///./pages/auth/_type.vue","webpack:///./pages/auth/_type.vue?e4c3","webpack:///./pages/auth/_type.vue?c13b"],"sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('el-tree',{ref:\"menuTree\",attrs:{\"data\":_vm.menuTree,\"show-checkbox\":\"\",\"node-key\":\"level\",\"check-on-click-node\":\"\",\"default-expand-all\":\"\",\"highlight-current\":\"\",\"props\":_vm.defaultProps},on:{\"check-change\":_vm.changeNodeCheck},scopedSlots:_vm._u([{key:\"default\",fn:function(ref){\nvar node = ref.node;\nvar data = ref.data;\nreturn _c('span',{staticClass:\"custom-tree-node\"},[_c('span',[_c('i',{class:data.icon}),_vm._v(_vm._s(_vm.$t(node.label)))])])}}])}),_vm._ssrNode(\" \"),_c('el-button',{attrs:{\"type\":\"primary\"},on:{\"click\":_vm.onSubmit}},[_vm._v(\"\\n    \"+_vm._s(_vm.$t('content.update'))+\"\\n  \")])],2)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nexport default {\n  watch: {\n    '$route.query': '$fetch',\n  },\n  data() {\n    return {\n      // data: this.$store.state.menu,\n      defaultProps: {\n        children: 'subMenu',\n        label: 'name',\n      },\n      checkedKeys: [],\n    }\n  },\n  computed: {\n    menuTree() {\n      return this.$store.state.identityMenu\n    },\n  },\n  async fetch() {\n    // console.log(\"this.$route\", this.$route)\n    const identity = await this.$axios.$get('/api/admin/identityList', {\n      params: {\n        'en-us': this.$route.params.type,\n      },\n    })\n    // console.log(\"identity\", identity.data.menu)\n\n    if (identity.success) {\n      if (identity.data.menu && identity.data.menu != ' ') {\n        // console.log(\"Object.assign(this.$store.state.defaultMenu, JSON.parse(identity.data.menu)))\", deepClone(this.$store.state.defaultMenu, JSON.parse(identity.data.menu)))\n        // console.log(\"JSON.parse(identity.data.menu)\", JSON.parse(identity.data.menu))\n        // console.log(\"extendIdentityMenu\")\n        await this.$store.commit('setIdentityMenu')\n        await this.$store.commit('extendIdentityMenu', {\n          identityMenu: this.$store.state.identityMenu,\n          menu: JSON.parse(identity.data.menu),\n        })\n      } else {\n        // console.log(\"setIdentityMenu\")\n        // this.$store.getters.addRootMenu(this.$store.state.identityMenu)\n        await this.$store.commit('setIdentityMenu')\n      }\n      this.getCheckedNodes(this.$store.state.identityMenu)\n      this.$refs.menuTree\n        ? this.$refs.menuTree.setCheckedKeys(this.checkedKeys)\n        : ''\n    }\n  },\n  // 加载完成\n  mounted() {\n    this.$refs.menuTree.setCheckedKeys(this.checkedKeys)\n  },\n  methods: {\n    async onSubmit() {\n      console.log(\n        'JSON.stringify(this.menuTree)',\n        JSON.stringify(this.menuTree)\n      )\n      const identityListUpdate = await this.$axios\n        .$post('/api/admin/identityList/update', {\n          'en-us': this.$route.params.type,\n          menu: JSON.stringify(this.menuTree),\n        })\n        .catch((error) => {\n          this.$message({\n            showClose: true,\n            message: `${this.$t('content.update')}${this.$t('content.fail')}! ${\n              error.response.data.message\n            }`,\n            type: 'error',\n          })\n        })\n      console.log(identityListUpdate)\n      if (identityListUpdate.success) {\n        this.$message({\n          showClose: true,\n          message: `${this.$t('content.update')}${this.$t('content.success')}`,\n          type: 'success',\n        })\n      } else {\n        this.$message({\n          showClose: true,\n          message: `${this.$t('content.update')}${this.$t('content.fail')}!${\n            identityListUpdate.message\n          }`,\n          type: 'error',\n        })\n      }\n    },\n    changeNodeCheck(data, check, children) {\n      // console.log('changeNodeCheck', data, check, children)\n      let checked = 0\n      if (check && !children) {\n        // true false\n        checked = 1\n      } else if (!check && children) {\n        // false true\n        checked = 2\n      }\n      this.$store.commit('changeMenuChedked', {\n        level: data.level,\n        checked,\n      })\n\n      // console.log(this.menuTree)\n    },\n    getCheckedNodes(data) {\n      // console.log(\"getCheckedNodes\", data)\n      for (let item of data) {\n        if (item.subMenu) {\n          this.getCheckedNodes(item.subMenu)\n        }\n        if (item.checked === 1) {\n          // console.log(\"item.level\", item.level)\n          this.checkedKeys.push(item.level)\n        }\n      }\n    },\n  },\n}\n","import mod from \"-!../../node_modules/babel-loader/lib/index.js??ref--2-0!../../node_modules/@nuxt/components/dist/loader.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./_type.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/babel-loader/lib/index.js??ref--2-0!../../node_modules/@nuxt/components/dist/loader.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./_type.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./_type.vue?vue&type=template&id=58e59bfd&scoped=true&\"\nimport script from \"./_type.vue?vue&type=script&lang=js&\"\nexport * from \"./_type.vue?vue&type=script&lang=js&\"\nfunction injectStyles (context) {\n  \n  \n}\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  injectStyles,\n  \"58e59bfd\",\n  \"52436a32\"\n  \n)\n\nexport default component.exports"],"mappings":";;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AADA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AANA;AAQA;AACA;AAAA;AACA;AACA;AACA;AACA;AAJA;AACA;AAIA;AACA;AACA;AACA;AACA;AADA;AADA;AACA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAGA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAIA;AAEA;AACA;AAFA;AAKA;AACA;AACA;AAGA;AALA;AAOA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AACA;AAGA;AALA;AAOA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAFA;AAMA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAlEA;AArDA;;ACvBA;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;A","sourceRoot":""}