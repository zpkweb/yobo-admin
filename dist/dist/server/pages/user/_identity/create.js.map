{"version":3,"file":"pages/user/_identity/create.js","sources":["webpack:///./pages/user/_identity/create.vue?8c7d","webpack:///./pages/user/_identity/create.vue?b1c4","webpack:///./pages/user/_identity/create.vue?0ef5","webpack:///./pages/user/_identity/create.vue?cbcc","webpack:///./pages/user/_identity/create.vue","webpack:///./pages/user/_identity/create.vue?1e50","webpack:///./pages/user/_identity/create.vue?1ef8"],"sourcesContent":["// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../node_modules/css-loader/dist/cjs.js??ref--3-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--3-oneOf-1-2!../../../node_modules/@nuxt/components/dist/loader.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./create.vue?vue&type=style&index=0&id=723c6336&scoped=true&lang=css&\");\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add CSS to SSR context\nvar add = require(\"!../../../node_modules/vue-style-loader/lib/addStylesServer.js\").default\nmodule.exports.__inject__ = function (context) {\n  add(\"18f2d2ae\", content, true, context)\n};","export * from \"-!../../../node_modules/vue-style-loader/index.js??ref--3-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--3-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--3-oneOf-1-2!../../../node_modules/@nuxt/components/dist/loader.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./create.vue?vue&type=style&index=0&id=723c6336&scoped=true&lang=css&\"","// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../../../node_modules/css-loader/dist/runtime/api.js\");\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.id, \".user-create[data-v-723c6336]{width:100%;display:flex;align-items:center;justify-content:center}.user-create-form[data-v-723c6336]{width:90%}.avatar-uploader .el-upload[data-v-723c6336]{border:1px dashed #d9d9d9;border-radius:6px;cursor:pointer;position:relative;overflow:hidden}.avatar-uploader .el-upload[data-v-723c6336]:hover{border-color:#409eff}.avatar-uploader-icon[data-v-723c6336]{font-size:28px;color:#8c939d;width:88px;height:88px;line-height:88px;text-align:center}.avatar[data-v-723c6336]{width:88px;height:88px;display:block}\", \"\"]);\n// Exports\nmodule.exports = exports;\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"user-create\"},[_c('el-form',{ref:\"userCreate\",staticClass:\"user-create-form\",attrs:{\"model\":_vm.userCreate,\"rules\":_vm.rules,\"label-width\":\"100px\"}},[_c('el-form-item',{attrs:{\"label\":_vm.$t('user.avatar'),\"prop\":\"avatar\"}},[_c('el-upload',{staticClass:\"avatar-uploader\",attrs:{\"action\":((_vm.$config.origin) + \"/api/upload/images\"),\"data\":{ type: 'avatar' },\"show-file-list\":false,\"on-success\":_vm.handleAvatarSuccess,\"before-upload\":_vm.beforeAvatarUpload},model:{value:(_vm.userCreate.avatar),callback:function ($$v) {_vm.$set(_vm.userCreate, \"avatar\", $$v)},expression:\"userCreate.avatar\"}},[(_vm.userCreate.avatar)?_c('img',{staticClass:\"avatar\",attrs:{\"src\":_vm.userCreate.avatar}}):_c('i',{staticClass:\"el-icon-plus avatar-uploader-icon\"})])],1),_vm._v(\" \"),_c('el-form-item',{attrs:{\"label\":_vm.$t('user.name'),\"prop\":\"name\"}},[_c('el-input',{attrs:{\"placeholder\":_vm.$t('form.placeholder', { msg: _vm.$t('user.name') })},model:{value:(_vm.userCreate.name),callback:function ($$v) {_vm.$set(_vm.userCreate, \"name\", $$v)},expression:\"userCreate.name\"}})],1),_vm._v(\" \"),_c('el-form-item',{attrs:{\"label\":_vm.$t('user.email'),\"prop\":\"email\"}},[_c('el-input',{attrs:{\"placeholder\":_vm.$t('form.placeholder', { msg: _vm.$t('user.email') })},model:{value:(_vm.userCreate.email),callback:function ($$v) {_vm.$set(_vm.userCreate, \"email\", $$v)},expression:\"userCreate.email\"}})],1),_vm._v(\" \"),_c('el-form-item',{attrs:{\"label\":_vm.$t('user.phone'),\"prop\":\"phone\"}},[_c('el-input',{attrs:{\"placeholder\":_vm.$t('form.placeholder', { msg: _vm.$t('user.phone') })},model:{value:(_vm.userCreate.phone),callback:function ($$v) {_vm.$set(_vm.userCreate, \"phone\", $$v)},expression:\"userCreate.phone\"}})],1),_vm._v(\" \"),_c('el-form-item',{attrs:{\"label\":_vm.$t('user.password'),\"prop\":\"password\"}},[_c('el-input',{attrs:{\"placeholder\":_vm.$t('form.placeholder', { msg: _vm.$t('user.password') })},model:{value:(_vm.userCreate.password),callback:function ($$v) {_vm.$set(_vm.userCreate, \"password\", $$v)},expression:\"userCreate.password\"}})],1),_vm._v(\" \"),_c('el-form-item',[(_vm.isCreate)?_c('el-button',{attrs:{\"type\":\"primary\",\"icon\":\"el-icon-circle-plus-outline\"},on:{\"click\":function($event){return _vm.submitForm('userCreate')}}},[_vm._v(\"\\n        \"+_vm._s(_vm.$t('content.create'))+\"\\n      \")]):_c('el-button',{attrs:{\"type\":\"primary\",\"icon\":\"el-icon-check\"},on:{\"click\":function($event){return _vm.submitForm('userCreate')}}},[_vm._v(\"\\n        \"+_vm._s(_vm.$t('content.update'))+\"\\n      \")]),_vm._v(\" \"),_c('el-button',{attrs:{\"icon\":\"el-icon-check\"},on:{\"click\":_vm.onMock}},[_vm._v(\" \"+_vm._s(_vm.$t('content.fill'))+\" \")]),_vm._v(\" \"),_c('el-button',{attrs:{\"icon\":\"el-icon-circle-close\"},on:{\"click\":function($event){return _vm.resetForm('userCreate')}}},[_vm._v(_vm._s(_vm.$t('content.clear')))])],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport Mock from 'mockjs';\n\nexport default {\n  async fetch() {\n    // console.log('fetch this.$refs.userCreate', this.$refs.userCreate)\n    // this.$refs.userCreate.resetFields()\n\n    if (this.$route.query && this.$route.query.userId) {\n\n      this.userId = this.$route.query.userId\n\n      const user = await this.$axios.$get('/api/admin/user', {\n        params: {\n          userId: this.userId,\n        },\n      })\n\n      if (user.success) {\n        this.userCreate = Object.assign(this.userCreate, user.data)\n        this.type = 'edit'\n        this.typeText = this.$t('content.update')\n        this.isCreate = false\n        this.rules.password[0].required = false\n      }\n    }\n  },\n  data() {\n    // var validateEmail = (rule, value, callback) => {\n    //   if (!value && !this.userCreate.phone) {\n    //     callback(new Error('\b邮箱和手机必须输入一项'))\n    //   } else {\n    //     if (!this.userCreate.phone) {\n    //       this.$refs.userCreate.clearValidate('phone')\n    //     }\n    //     callback()\n    //   }\n    // }\n    // var validatePhone = (rule, value, callback) => {\n    //   if (!this.userCreate.email && !value) {\n    //     callback(new Error('\b邮箱和手机必须输入一项'))\n    //   } else {\n    //     if (!this.userCreate.email) {\n    //       this.$refs.userCreate.clearValidate('email')\n    //     }\n    //     callback()\n    //   }\n    // }\n    return {\n      type: 'create', // create edit\n      typeText: this.$t('content.create'),\n      isCreate: true,\n      userId: '',\n      userCreate: {\n        avatar: '',\n        name: '',\n        email: '',\n        phone: '',\n        password: '',\n        identity: [],\n      },\n      rules: {\n        // name: [{ required: true, message: '请输入姓名', trigger: 'blur' }],\n        email: [\n          {\n            required: true,\n            message: this.$t('form.placeholder', {\n              msg: this.$t('user.email'),\n            }),\n            trigger: 'blur',\n          },\n        ],\n        // phone: [{ validator: validatePhone, trigger: 'blur' }],\n        password: [\n          {\n            required: true,\n            message: this.$t('form.placeholder', {\n              msg: this.$t('user.password'),\n            }),\n            trigger: 'blur',\n          },\n        ],\n\n        // identity: [\n        //   {\n        //     type: 'array',\n        //     required: true,\n        //     message: '请至少选择一个身份',\n        //     trigger: 'change',\n        //   },\n        // ],\n      },\n    }\n  },\n  // watchQuery: ['userId','sellerId'],\n  watch: {\n    '$route.query': '$fetch',\n  },\n  methods: {\n    submitForm(userCreate) {\n      this.$refs[userCreate].validate(async (valid) => {\n        if (valid) {\n          let data\n          if (this.isCreate) {\n            data = await this.$axios\n              .$post('/api/admin/user/register', {\n                identity: this.$route.params.identity,\n                avatar: this.userCreate.avatar,\n                name: this.userCreate.name,\n                email: this.userCreate.email,\n                phone: this.userCreate.phone,\n                password: this.userCreate.password,\n              })\n              .catch((error) => {\n                this.$message({\n                  showClose: true,\n                  message: `${this.typeText}${this.$t('content.fail')}! ${\n                    error.response.data.message\n                  }`,\n                  type: 'error',\n                })\n              })\n          } else {\n            data = await this.$axios.$post('/api/admin/user/update', {\n              userId: this.userId,\n              avatar: this.userCreate.avatar,\n              name: this.userCreate.name,\n              email: this.userCreate.email,\n              phone: this.userCreate.phone,\n              password: this.userCreate.password,\n            })\n          }\n          if (data.status === 200) {\n            this.$message({\n              showClose: true,\n              message: `${this.userCreate.name}，${this.typeText}${this.$t('content.success')}`,\n              type: 'success',\n            })\n            if (this.isCreate) {\n              this.$refs[userCreate].resetFields()\n            }\n          } else {\n            this.$message({\n              showClose: true,\n              message: `${this.typeText}${this.$t('content.fail')}!${data.message}`,\n              type: 'error',\n            })\n          }\n        } else {\n          console.log('error submit!!')\n          return false\n        }\n      })\n    },\n    resetForm(userCreate) {\n      this.$refs[userCreate].resetFields()\n    },\n    onMock() {\n      this.userCreate = {\n        avatar: '',\n        name: Mock.mock('@cname'),\n        email: Mock.mock('@email'),\n        password: '123',\n      }\n    },\n    handleAvatarSuccess(res, file) {\n      // this.userCreate.avatar = URL.createObjectURL(file.raw);\n      this.userCreate.avatar = res.data.src\n    },\n    beforeAvatarUpload(file) {\n      // const isJPG = file.type === 'image/jpeg';\n      const isLt2M = file.size / 1024 / 1024 < 2\n\n      // if (!isJPG) {\n      //   this.$message.error('上传头像图片只能是 JPG 格式!');\n      // }\n      if (!isLt2M) {\n        this.$message.error('上传头像图片大小不能超过 2MB!')\n      }\n      // return isJPG && isLt2M;\n      // return isLt2M\n    },\n  },\n}\n","import mod from \"-!../../../node_modules/babel-loader/lib/index.js??ref--2-0!../../../node_modules/@nuxt/components/dist/loader.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./create.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/babel-loader/lib/index.js??ref--2-0!../../../node_modules/@nuxt/components/dist/loader.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./create.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./create.vue?vue&type=template&id=723c6336&scoped=true&\"\nimport script from \"./create.vue?vue&type=script&lang=js&\"\nexport * from \"./create.vue?vue&type=script&lang=js&\"\nfunction injectStyles (context) {\n  \n  var style0 = require(\"./create.vue?vue&type=style&index=0&id=723c6336&scoped=true&lang=css&\")\nif (style0.__inject__) style0.__inject__(context)\n\n}\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  injectStyles,\n  \"723c6336\",\n  \"4ebc640d\"\n  \n)\n\nexport default component.exports"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACVA;AAAA;AAAA;AAAA;;;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACNA;AACA;AACA;;;;;;;;;ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AADA;AADA;AACA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AAQA;AACA;AACA;AAEA;AACA;AACA;AADA;AAGA;AALA;AAQA;AACA;AAEA;AACA;AACA;AADA;AAGA;AALA;AAUA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA9BA;AAbA;AA6CA;AACA;AAAA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AANA;AASA;AACA;AACA;AAGA;AALA;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AAQA;AACA;AAAA;AACA;AACA;AACA;AACA;AAHA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAGA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AAAA;AACA;AApFA;AA/FA;;ACxEA;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;A","sourceRoot":""}